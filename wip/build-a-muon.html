<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Build a Muon</title>
  <meta name="description" content="Learn how to build a new implementation of Muon and Muon apis">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style3.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link href="/css/style.css" rel="stylesheet"/>
    <link rel="canonical" href="http://daviddawson.me/wip/build-a-muon.html">
    <link rel="alternate" type="application/rss+xml" title="David Dawson" href="http://daviddawson.me/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/asciidoc.css">
  <link rel="stylesheet" href="/css/producttable.css">
  <style>
  @media only screen and (min-width:768px){#toctitle{font-size:1.375em}
    body.toc2{padding-left:15em;padding-right:0}
#toc {margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;right:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc >ul{font-size:.9em;margin-bottom:0}
#toc ul ul{margin-left:0;padding-left:1em}
#toc ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
  @media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc {width:20em}
#toc #toctitle{font-size:1.375em}
#toc >ul{font-size:.95em}
#toc ul ul{padding-left:1.25em}
      body.toc2.toc-right{padding-left:0;padding-right:20em}}

#toc { z-index:20; padding-top:120px;}
#documentation { padding-left:10px; margin-left:auto; margin-right:auto}
#documentation .row { margin:auto }
    code {
      background:none;
      border:0;
    }

    code span { border: 0; width:100% }
  .listingblock {
      background: #eee;
      border-radius:5px;
      border:1px solid #ccc
    }
  }

  div.documentation a.btn {
    margin-top:20px;
    background: #3498db;
    background-image: -webkit-linear-gradient(top, #3498db, #2980b9);
    background-image: -moz-linear-gradient(top, #3498db, #2980b9);
    background-image: -ms-linear-gradient(top, #3498db, #2980b9);
    background-image: -o-linear-gradient(top, #3498db, #2980b9);
    background-image: linear-gradient(to bottom, #3498db, #2980b9);
    -webkit-border-radius: 28;
    -moz-border-radius: 28;
    border-radius: 28px;
    font-family: Arial;
    color: #ffffff;
    font-size: 20px;
    padding: 10px 20px 10px 20px;
    text-decoration: none;
  }

  div.documentation a.btn:hover {
    background: #3cb0fd;
    background-image: -webkit-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -moz-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -ms-linear-gradient(top, #3cb0fd, #3498db);
    background-image: -o-linear-gradient(top, #3cb0fd, #3498db);
    background-image: linear-gradient(to bottom, #3cb0fd, #3498db);
    text-decoration: none;
  }

  div.documentation h2 {
    font-size:1.5em
  }

  div.documentation code, div.documentation .sidebarblock .content {
    font-size: 1.0625rem;
  }

  .sect1 .sectionbody .content {
    padding:0;
  }

  </style>

  <link rel="stylesheet" href="/css/sidebar2.css">
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6919980001759109",
      enable_page_level_ads: true
    });
  </script>
</head>


  <body>
    
      <a id='top'></a>

<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1 class="sitetitle">
          <a href="http://daviddawson.me/">
            David Dawson <small>from microservices to IoT in all the languages</small>
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              <a href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a href="/me.html">About Me | What I Do</a>
            </li>
          
        
          
            <li class="has-dropdown">
              <a href="/training/microservices.html">Training</a>
              <ul class='dropdown'>
                
                  <li>
                    <a href="/training/microservices-free.html">Free Microservice Healthcheck</a>
                  </li>
                
                  <li>
                    <a href="/training/microservices.html">3 Reactive Microservices Workshop</a>
                  </li>
                
                  <li>
                    <a href="/training/groovy.html">Groovy</a>
                  </li>
                
              </ul>
            </li>
          
        
          
            <li>
              <a href="/hireme.html">Hire Me</a>
            </li>
          
        
          
            <li>
              <a href="https://github.com/daviddawson">Github</a>
            </li>
          
        
      </ul>
    </section>
  </nav>
</div>

    

    <div id='main' role='main'>
      <div class="documentation">
  <div class='full' style='background: #000'>
    <div class='row' style="margin-left:auto; margin-right:auto; max-width:100%">
      <div class='large-12 columns'>
        <div class='mod modBlogPost big'>
          <div id='main' role='main' class='content' style="font-size:1.2rem ">
            <div class='full documentation'>
  <div class='row'>
        <div class='images'>
          
            <div class='image' style="height:100px;"><img style="height:inherit" alt="" src="http://daviddawson.me/images/muonfulllogo.jpg" /></div>
          
        </div>
        <div class='content'>
          <p class='info'>


            <span>September 06, 2017</span>
          </p>
          <h3><a href="/wip/build-a-muon.html">Build a Muon</a></h3>
          <div class="paragraph">
<p>Muon is a toolkit for building Reactive/ message based apis. Thia article describes how to implement Muon, including discussing the core Muon model and rationale for the major design decisions.</p>
</div>
<div class="paragraph">
<p>Being an api approach, Muon is defined ultimately by the messages that are exchanged between services and the order they are exchanged in. Message definitions and interaction protocols described in this document are mandatory for implementing Muon correctly.</p>
</div>
<div class="sect1">
<h2 id="terms-and-visualisations">Terms and visualisations</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Muon model is a restricted form of Communicating Sequential Processes  (CSP). This places the channel as the primary design primitive in this system.</p>
</div>
<div class="paragraph">
<p>Muon is therefore implemented as a set of components, connected by bi directional channels. Some of these channels bridge a network, and are implemented by <em>transports</em>.  In order to visualise this and be able to understand and communicate about it more easily, we have adopted a common visualisation metaphor that we use in diagrams, and in code.</p>
</div>
<div class="paragraph">
<p>Here is an example.</p>
</div>
<div class="paragraph">
<p>todo. example.</p>
</div>
<div class="paragraph">
<p>Here, you can see the various components and channels arranged horizontally and connected on their left/ right sides to others. These are the terms that we use, <em>left</em> and <em>right</em>. When you see these in code, or as part of a design document, it is always referring to this visual arrangement.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="message-formats-and-core-protocols">Message formats and core protocols</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Muon operates in layers. It&#8217;s messaging formats represent that explicitly. You can see that in this example. todo, diagram.</p>
</div>
<div class="paragraph">
<p>The central layer is common across all apis and transports, which we refer to as Muon Messages. This an example message, represented as JSON (which is not the only transport representation)</p>
</div>
<div class="paragraph">
<p>todo. a muon message.</p>
</div>
<div class="paragraph">
<p>This schema is used by all protocols. the role of the protocol is to create and consume Muon Messages appropriately. The protocol will encode its data into the muon message payload field and indicate where in the protocol state machine it is by using the <em>step</em> field.</p>
</div>
<div class="paragraph">
<p>How the messages are used by them higher protocols is not restricted.</p>
</div>
<div class="sect2">
<h3 id="example-protocol-messages-rpc">Example protocol messages. RPC.</h3>
<div class="paragraph">
<p>The apis have their own messages that they must encode and decode into Muon Messages. These are not restricted in any way, and once encoded into the muon message payload, is ignored by all other Muon components.</p>
</div>
<div class="paragraph">
<p>To give a worked example. Simple rpc (this is not the actual rpc protocol)</p>
</div>
<div class="paragraph">
<p>The app code will make a request, somehow. The client protocol will generate a message to represent that request. It could look like this (as JSON).</p>
</div>
<div class="paragraph">
<p>todo exanple request.</p>
</div>
<div class="paragraph">
<p>It will then encode that and generate a Muon message holding that, and indicating the protocol step.</p>
</div>
<div class="paragraph">
<p>The Muon message would look like this.</p>
</div>
<div class="paragraph">
<p>Then, the api opens a new channel to the remote service and sends the message.</p>
</div>
<div class="paragraph">
<p>On the server side in the remote service, Muon understands the protocol that has been requested and begins a new protocol session, assuming it supports the given protocol!</p>
</div>
<div class="paragraph">
<p>The server side rpc protocol will receive the Muon message above, and will then decode the payload. Based on the content, it can use whatever api it has available to do some work  (e.g. call a function). Once complete, it will generate a response message, encode and wrap that into a muon message. The messages would look like this.</p>
</div>
<div class="paragraph">
<p>todo.  response messages</p>
</div>
<div class="paragraph">
<p>Once done, it can close the channel. The client receives the message, unpacks it and completes its work.</p>
</div>
<div class="paragraph">
<p>RPC is a very simple protocol, but I hope you can see how more complex protocols can be designed and built easily using this approach.</p>
</div>
</div>
<div class="sect2">
<h3 id="transport-messages">Transport messages</h3>
<div class="paragraph">
<p>Transports deal with moving muon messages from one service to another.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="implementation-guide">Implementation guide</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client and server portions of Muon are fairly distinct, and can be implemented independently. If you are implementing a new Muon, it is recommended you pick one of these and fully implement it before moving to the other. This guide assumes you will implement the client, along with common components, first.</p>
</div>
<div class="paragraph">
<p>The following component design is recommended, but is not required to implement Muon correctly. The only requirement for building a conformant muon implementation is to follow the message protocols and message schemas.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="client-components">Client Components</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The client portion of Muon has the responsibility for</p>
</div>
<div class="sect2">
<h3 id="channel-and-message-dispatch">Channel and message dispatch</h3>

</div>
<div class="sect2">
<h3 id="codecs">Codecs</h3>

</div>
<div class="sect2">
<h3 id="transport-interface">Transport interface</h3>

</div>
<div class="sect2">
<h3 id="discovery">Discovery</h3>

</div>
<div class="sect2">
<h3 id="transport-client">Transport client</h3>
<div class="sect3">
<h4 id="shared-channel-multiplex-optional">Shared channel/ multiplex (optional)</h4>

</div>
</div>
<div class="sect2">
<h3 id="implement-the-api-type">Implement the API type</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="server-components">Server Components</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="server-stacks">Server Stacks</h3>

</div>
<div class="sect2">
<h3 id="discovery-2">Discovery</h3>

</div>
<div class="sect2">
<h3 id="server-side-api">Server side api</h3>

</div>
<div class="sect2">
<h3 id="shared-channel-multiplex">Shared channel/ multiplex</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="implementing-an-api-type">Implementing an API type</h2>
<div class="sectionbody">

</div>
</div>
<div class="sect1">
<h2 id="introspection-api">Introspection api</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Once you have finished all aspects of this guide, you will have a fully working Muon. Unfortunately, it won&#8217;t actually do that much!  For it to be useful, you have to implement one of the api protocols on top of it. For the server side, you should have a minimal introspection all at the very least</p>
</div>
<div class="paragraph">
<p>Each Muon api is very different in the way it operates, but they all share common defining features. They all connect to one or more other Muon service, by opening channels to them, and then exchange messages according to their own internally defined messaging protocol.  In order to implement an existing api, you need to understand its messaging protocol and data schemas. Then, you can implement the protocol, and design a user facing api that is idiomatic in your runtime.</p>
</div>
</div>
</div>
            <p id="post-meta">


                <i class="fa fa-tag"></i>
                

                <a href="/blog/tags#muon">muon</a>,
                

                <a href="/blog/tags#reactive">reactive</a>,
                

                <a href="/blog/tags#microservices">microservices</a>,
                

                <a href="/blog/tags#reactive streams">reactive streams</a>,
                
                <a href="/blog/tags"><em>Browse all tags</em></a>
            </p>
        </div>


      <div class='four spacing'></div>
    <div class='large-3 columns' id='toc'>
      <div class='links'>
  <h3>Recent Posts</h3>
  <ul>
    
    
    <li><a href="/blog/2018/01/06/entity-microservices.html">Muon developer diary</a></li>
    
    
    <li><a href="/blog/2017/09/06/groovy-gorm-shell-script.html">Groovy gorm shell script</a></li>
    
    
    <li><a href="/blog/2017/09/06/diabetes-1-year-in.html">Diabetes at 35, 1 year in.</a></li>
    
    
    <li><a href="/blog/2017/08/13/build-reactive-polyglot-muon.html">Building reactive microservices using muon and scaling them using kafka, cassandra and friends</a></li>
    
    
    <li><a href="/blog/2017/07/10/styles-of-event-architecture.html">Styles of event architecture</a></li>
    
    
    <li><a href="/blog/2017/04/06/spring-generic-dao-generics.html">Generic dao in spring with parameterized types</a></li>
    
    
    
  </ul>
</div>
<div class='links'>
  <h3>Archives</h3>
  
  
  
  
  <h4 id="y2018">January 2018</h4>
  <ul>
    
    
    <li><a href="/blog/2018/01/06/entity-microservices.html">Muon Developer Diary</a></li>
    
  
  
  
  </ul>
  <h4 id="y2017">September 2017</h4>
  <ul>
    
    
    <li><a href="/blog/2017/09/06/groovy-gorm-shell-script.html">Groovy Gorm Shell Script</a></li>
    
  
  
  
    <li><a href="/blog/2017/09/06/diabetes-1-year-in.html">Diabetes at 35, 1 year in.</a></li>
    
  
  
  
  </ul>
  <h4 id="y2017">August 2017</h4>
  <ul>
    
    
    <li><a href="/blog/2017/08/13/build-reactive-polyglot-muon.html">Building Reactive Microservices using Muon and scaling them using Kafka, Cassandra and friends</a></li>
    
  
  
  
  </ul>
  <h4 id="y2017">July 2017</h4>
  <ul>
    
    
    <li><a href="/blog/2017/07/10/styles-of-event-architecture.html">Styles of Event Architecture</a></li>
    
  
  
  
  </ul>
  <h4 id="y2017">April 2017</h4>
  <ul>
    
    
    <li><a href="/blog/2017/04/06/spring-generic-dao-generics.html">Generic DAO in Spring with Parameterized Types</a></li>
    
  
  
  
  </ul>
  <h4 id="y2017">February 2017</h4>
  <ul>
    
    
    <li><a href="/blog/2017/02/28/experiments-with-rancher-and-kubernetes.html">Building a deploy environment on AWS- Experiments with Rancher and Kubernetes</a></li>
    
  
  
  
    <li><a href="/muon-devdiary/2017/02/22/muon-developer-diary.html">Muon Developer Diary</a></li>
    
  
  
  
    <li><a href="/blog/2017/02/21/muon-intro.html">Introducing Muon</a></li>
    
  
  
  
    <li><a href="/blog/2017/02/04/simplicity-itself-shutdown.html">Shutting down Simplicity Itself</a></li>
    
  
  
  
  </ul>
  <h4 id="y2016">November 2016</h4>
  <ul>
    
    
    <li><a href="/blog/2016/11/03/make-developer-api.html">A Microservices Developer API using .... Make</a></li>
    
  
  
  
  </ul>
  <h4 id="y2016">July 2016</h4>
  <ul>
    
    
    <li><a href="/microservices/2016/07/20/microservices-philosophy.html">Microservices and Philosophy</a></li>
    
  
  
  
  </ul>
  <h4 id="y2016">March 2016</h4>
  <ul>
    
    
    <li><a href="/blog/2016/03/11/the-minilith-tightly-coupled-microservices.html">The Minilith - Tightly Coupled Microservices</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">June 2015</h4>
  <ul>
    
    
    <li><a href="/microservices%20and%20reactive/2015/06/17/defining-microservice-architecture.html">Defining The Microservice Architecture</a></li>
    
  
  
  
    <li><a href="/getting/started/with/microservices/2015/06/10/service-discovery-overview.html">Service Discovery Overview</a></li>
    
  
  
  
    <li><a href="/microservices%20and%20reactive/2015/06/04/microservices-security-oauth-vs-session.html">Microservices Security&#58; OAuth vs Session</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">March 2015</h4>
  <ul>
    
    
    <li><a href="/microservices%20and%20reactive/2015/03/02/the-real-silver-bullet.html">Best Practice Developer techniques&#58; The Hunt for The Silver Bullet</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">February 2015</h4>
  <ul>
    
    
    <li><a href="/microservices%20and%20reactive/2015/02/16/retiring-microservices-using-strangulation.html">Retiring Microservices Using Strangulation</a></li>
    
  
  
  
    <li><a href="/microservices%20and%20reactive/2015/02/10/avoid-microservice-platform-lock-in-service-discovery.html">Avoid Microservice Platform Lock In using Service Discovery</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">January 2015</h4>
  <ul>
    
    
    <li><a href="/blog/2015/01/23/the-role-of-data-in-microservices.html">The Role of Data in Microservices</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/12/sharing-code-between-microservices.html">Sharing Code Between Microservices?</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/09/development-by-slogan-dry-part3.html">Development by Slogan with DRY&#58; Part 3, DRY vs WET</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/08/development-by-slogan-dry-part2.html">Development by Slogan with DRY&#58; Part 2, The Tower of Coupling</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/01/development-by-slogan-dry-part1.html">Development by Slogan with DRY&#58; Part 1, Really DRY</a></li>
    
  
  
  
  </ul>
  <h4 id="y2013">April 2013</h4>
  <ul>
    
    
    <li><a href="/blog/2013/04/21/all-hail-command.html">Simplicity in Grails Design – All Hail the Command Object</a></li>
    
  
  
  
    <li><a href="/blog/2013/04/18/future-of-grails.html">The Future of Grails</a></li>
    
  
  
  
  </ul>
  <h4 id="y2013">March 2013</h4>
  <ul>
    
    
    <li><a href="/blog/2013/03/28/stateless-services-are-evil.html">Simplicity in Web Architecture - Beware the Stateless Service</a></li>
    </ul>
  
</div>
<div class='links'>
  <a href="/blog/tags"><em>Browse all tags</em></a>
</div>

<div class='links'>

</div>

    </div>
  </div>
</div>

          </div>
        </div>
        <div class='four spacing'></div>
      </div>
    </div>
  </div>
</div>

    </div>

    <div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>©2017 David Dawson Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91527202-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
