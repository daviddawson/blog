<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Sharing Code Between Microservices?</title>
  <meta name="description" content="This article was originally posted at simplicityitself.com.Simplicity Itself has now closed, and so I have moved my articles here.If you would like to read u...">

    <link rel="stylesheet" href="/css/foundation.css">

    <link rel="stylesheet" href="/css/style2.css">
  <link rel="stylesheet" href="/css/fontello.css">
  <link rel="stylesheet" href="/css/font-awesome.css">
  <script src="/javascripts/modernizr.foundation.js" type="text/javascript"></script>
    <script src="/javascripts/jquery-2.1.0.js" type="text/javascript"></script>
    <script src="/javascripts/terrific-1.1.1.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.url.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.cookie.js" type="text/javascript"></script>
    <script src="/javascripts/json2.js" type="text/javascript"></script>
    <script src="/javascripts/foundation.js" type="text/javascript"></script>
  <script>
    // terrificjs bootstrap
    (function($) {
        $(document).ready(function() {
            var $page = $('body');
            var config = {
              dependencyPath: {
                plugin: 'javascripts/'
              }
            }
            var application = new Tc.Application($page, config);
            application.registerModules();
            application.start();
        });
    })(Tc.$);
  </script>
  <link href="http://fonts.googleapis.com/css?family=Raleway:400,700,300" media="screen" rel="stylesheet" type="text/css" />
  <script src="/javascripts/masonry.pkgd.js" type="text/javascript"></script>
  <script src="/javascripts/imagesloaded.pkgd.min.js" type="text/javascript"></script>
  <script src="/javascripts/slick.min.js" type="text/javascript"></script>

  <link rel="canonical" href="/blog/2015/01/12/sharing-code-between-microservices.html">
  <link rel="alternate" type="application/rss+xml" title="David Dawson" href="/feed.xml" />
  <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
          <link rel="stylesheet" href="/css/asciidoc.css">
  <link href="/css/sidebar2.css" rel="stylesheet"/>
  <link href="/css/mediaq.css" rel="stylesheet"/>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6919980001759109",
      enable_page_level_ads: true
    });
  </script>
</head>


  <body>
    
      <a id='top'></a>

<div class='contain-to-grid sticky fullwidth'>
  <nav class='top-bar onepage' data-options='sticky_on: large' data-topbar=''>
    <ul class='title-area'>
      <li class='name'>
        <h1 class="sitetitle">
          <a href="/">
            David Dawson <small>from microservices to IoT in all the languages</small>
          </a>
        </h1>
      </li>
      <li class='toggle-topbar menu-icon'>
        <a href='#'>Menu</a>
      </li>
    </ul>
    <section class='top-bar-section'>
      <ul class='right'>
        
          
            <li>
              
                <a href="/">Blog</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/me.html">About Me | What I Do</a>
              

            </li>
          
        
          
            <li>
              
                <a href="/hireme.html">Hire Me</a>
              

            </li>
          
        
          
            <li>
              
                <a href="https://github.com/daviddawson">Github</a>
              

            </li>
          
        
      </ul>
    </section>
  </nav>
</div>

    

    <div id='main' role='main'>
      <div class="documentation">
  <div class='full' style='background: #000'>
    <div class='row' style="margin-left:auto; margin-right:auto; max-width:90rem">
      <div class='large-12 columns'>
        <div class='mod modBlogPost big'>
          <div id='main' role='main' class='content' style="font-size:1.2rem ">
            <div class='full documentation'>
  <div class='row'>
        <div class='images'>
          
        </div>
        <div class='content'>
          <p class='info'>


            <span>January 12, 2015</span>
          </p>
          <h3><a href="/blog/2015/01/12/sharing-code-between-microservices.html">Sharing Code Between Microservices?</a></h3>
          <div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This article was originally posted at simplicityitself.com.</p>
</div>
<div class="paragraph">
<p>Simplicity Itself has now closed, and so I have moved my articles here.</p>
</div>
<div class="paragraph">
<p>If you would like to read up on why it closed - See <a href="/blog/2017/02/04/simplicity-itself-shutdown.html">here</a></p>
</div>
<div class="paragraph">
<p>I now operate as a freelancer, specialising in Microservices, event systems, cloud foundry, IoT in many languages.</p>
</div>
<div class="paragraph">
<p>I run the <a href="http://muoncore.io/">Muon microservices platform project</a> and the <a href="http://meetup.com/London-Microservices-User-Group/">London Microservices User Group</a></p>
</div>
<div class="paragraph">
<p>I&#8217;m <a href="/hireme.html">available to hire</a> for small and large projects</p>
</div>
</td>
</tr>
</table>
</div>
<h1 id="sharing-code-between-microservices" class="sect0">Sharing Code Between Microservices?</h1>
<div class="paragraph">
<p>My good friend Peter Ledbrook has been pondering the question <a href="http://blog.cacoethes.co.uk/software/code-reuse-in-micro-services">how can we share code between microservices</a></p>
</div>
<div class="paragraph">
<p>This is something we&#8217;ve had the opportunity to experiment with, on new projects and also longer running systems. This has given us some insight, which I&#8217;m happy to share here.</p>
</div>
<div class="paragraph">
<p>The process for building a new microservice is pretty well established by now.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Define the service contract</p>
</li>
<li>
<p>Expose on a network (somehow, http, messaging, or maybe https://muoncore.io[Muon])</p>
</li>
<li>
<p>Profit?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>&#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>Sorry, that was mean of me!</p>
</div>
<div class="paragraph">
<p>More seriously then. In many of our conference talks we drop down to first principles and philosophy and I want to do that here too, as the answer to the question above can only be found when the real, underlying question is asked.  So, what is your motivation for building a microservice?</p>
</div>
<div class="paragraph">
<p>That will frame your answer, and we&#8217;ve found that the motivations for using microservices are actually fairly varied depending on the environment.</p>
</div>
<div class="paragraph">
<p>So, why make a microservice?  Some of the typical answers we get when we ask are  :-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Independently scale</p>
</li>
<li>
<p>'Ability to innovate'</p>
</li>
<li>
<p>Service isolation</p>
</li>
<li>
<p>Separate service life-cycles (deployment, build etc)</p>
</li>
<li>
<p>Monitor usage via gateways</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Our take is that these are all attempting to handle some form of <em>change</em>. This is what we always look for , change in the environment, change in the codebase. Differing rates of change between two areas
 are almost the sole guide that we use for splitting services apart.</p>
</div>
<div class="paragraph">
<p>These all sit on the concept of _isolation _of one form or another. This underpins almost all of the benefits, and almost all of the costs of microservices. Creating and maintaining that isolation barrier we know as the service contract. Microservices go one layer above something like OSGI, as they enforce a network hop in the service barrier, creating an extra air gap, so they are highly decoupled from a code execution point of view.</p>
</div>
<div class="paragraph">
<p>All of this setup is to create isolation_.<em> That isolation</em> _enables the other benefits of microservices.  This is the key point.</p>
</div>
<div class="sect1">
<h2 id="code-sharing">Code Sharing</h2>
<div class="sectionbody">
<div class="paragraph">
<p>So, sharing code. Why would we do this?</p>
</div>
<div class="paragraph">
<p>Primarily, I&#8217;ve found that developers and organisations want to share code across microservices for only a few reasons, although they may couch them in different terminology. This list is not complete, but takes in the majority.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Leverage existing technical functionality, eg, the impressive array of Netflix OSS libs, Guava, other utils.</p>
</li>
<li>
<p>Sharing data schemas, using a class, for example, as an enforcement of a shared schema.</p>
</li>
<li>
<p>Sharing data sources, use of the same database by multiple services.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>It is of utmost importance to pin down your motivation for wanting to share code, as unfortunately there is no right answer to this question. Like everything else, it&#8217;s contextual.</p>
</div>
<div class="paragraph">
<p>The order of the list above is important, I arranged them in how much coupling they will create across services, from least to most, with the most coupling created by sharing control of runtime data, through sharing a data schema, sharing technical/ infra libraries, to finally sharing nothing.</p>
</div>
<div class="paragraph">
<p>Code sharing, as when sharing anything, will always act to attach your services together via the shared code. This is unavoidable. The question you need to ask, is it worth it to do so?</p>
</div>
<div class="paragraph">
<p>You are crossing the isolation barrier, and so you <em>are</em> reducing the effectiveness of it. By sharing nothing, you are giving it the maximum possible effectiveness. That, though, also comes at a cost.</p>
</div>
<div class="paragraph">
<p>When you build a new service and share nothing, you feel like you have 'lost' the functionality that is available in the other services. In fact, you&#8217;ve traded it away to give yourself more isolation, by sharing more, you lose more isolation.  You gain the convenience of using existing code, at the cost of coupling more tightly to the other services in the system.</p>
</div>
<div class="paragraph">
<p>This demonstrably does occur even when you are sharing only technical libraries.  I&#8217;m sure that any Netflix guys (or other larger microservices implementations) reading can attest to "build the world" CI storms if one of the base libraries are changed. This is witnessing the infamous <em>ripple effect</em> in full force. Those seemingly innocuous, merely technical libraries will start to gain a whiff of 'scary'.  This is because altering them will cause a large scale redeploy of services unrelated the one being developed. Developers will start to avoid them if possible, for fear of the unknown effect that you may create.  There lies legacy &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>This, then, is just at the lowest level of sharing. If you attach at a higher level, sharing schemas, or even control of the data (via the sources), then you will suffer the ripple effect more often and it will hurt more when you hit it.  You will be carrying the cost of maintaining a microservices based architecture, without gaining the benefits of isolation, because you&#8217;ve shortcircuited it.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="micro-vs-mono">Micro vs Mono</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a fairly stark message, but one that I can&#8217;t avoid.   If you want convenience, build a monolith. They are significantly quicker to start a new project with, quicker to be able to alter the service boundaries as desired. To be able to get that initial jolt of primary development, they are the <em>right answer.</em></p>
</div>
<div class="paragraph">
<p>There is a continuum then, a constant tension between isolation and re-use. To lean to one is to lean away from the other. The discussion on <em>what</em> is shared has some value, but sharing anything has the same effect, just a greater or lesser severity.</p>
</div>
<div class="paragraph">
<p>The choice on which way you lean is of course, up to you.</p>
</div>
<div class="paragraph">
<p>The natural progression that we now expect in new Microservices implementations is :-</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Prepare the ground (the ability to break services off)</p>
</li>
<li>
<p>Build a Monolith in the primary development phase</p>
</li>
<li>
<p>As areas of the system stop changing, break them off as new services behind their stable barrier.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>At this point, they should share almost nothing with the monolith it has been pulled out from</p>
</div>
<div class="paragraph">
<p>During ongoing/ secondary development, new areas start life as new services.</p>
</div>
</div>
</div>
            <p id="post-meta">


                <i class="fa fa-tag"></i>
                

                <a href="/blog/tags#architecture">architecture</a>,
                

                <a href="/blog/tags#data schema">data schema</a>,
                

                <a href="/blog/tags#dry">DRY</a>,
                

                <a href="/blog/tags#life preserver">life preserver</a>,
                

                <a href="/blog/tags#microservices">microservices</a>,
                

                <a href="/blog/tags#muon">muon</a>,
                

                <a href="/blog/tags#netflix">netflix</a>,
                

                <a href="/blog/tags#netflix oss">netflix oss</a>,
                

                <a href="/blog/tags#sharing">sharing</a>,
                
                <a href="/blog/tags"><em>Browse all tags</em></a>
            </p>
        </div>


      <div class='four spacing'></div>
    <div class='large-3 columns' id='toc'>
      <div class='links'>
  <h3>Recent Posts</h3>
  <ul>
    
    
    <li><a href="/blog/2017/02/21/muon-intro.html">Introducing muon</a></li>
    
    
    <li><a href="/blog/2017/02/04/simplicity-itself-shutdown.html">Shutting down simplicity itself</a></li>
    
    
    <li><a href="/blog/2016/11/03/make-developer-api.html">A microservices developer api using .... make</a></li>
    
    
    <li><a href="/microservices/2016/07/20/microservices-philosophy.html">Microservices and philosophy</a></li>
    
    
    <li><a href="/blog/2016/03/11/the-minilith-tightly-coupled-microservices.html">The minilith - tightly coupled microservices</a></li>
    
    
    <li><a href="/microservices%20and%20reactive/2015/06/17/defining-microservice-architecture.html">Defining the microservice architecture</a></li>
    
    
    
  </ul>
</div>
<div class='links'>
  <h3>Archives</h3>
  
  
  
  
  <h4 id="y2017">February 2017</h4>
  <ul>
    
    
    <li><a href="/blog/2017/02/21/muon-intro.html">Introducing Muon</a></li>
    
  
  
  
    <li><a href="/blog/2017/02/04/simplicity-itself-shutdown.html">Shutting down Simplicity Itself</a></li>
    
  
  
  
  </ul>
  <h4 id="y2016">November 2016</h4>
  <ul>
    
    
    <li><a href="/blog/2016/11/03/make-developer-api.html">A Microservices Developer API using .... Make</a></li>
    
  
  
  
  </ul>
  <h4 id="y2016">July 2016</h4>
  <ul>
    
    
    <li><a href="/microservices/2016/07/20/microservices-philosophy.html">Microservices and Philosophy</a></li>
    
  
  
  
  </ul>
  <h4 id="y2016">March 2016</h4>
  <ul>
    
    
    <li><a href="/blog/2016/03/11/the-minilith-tightly-coupled-microservices.html">The Minilith - Tightly Coupled Microservices</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">June 2015</h4>
  <ul>
    
    
    <li><a href="/microservices%20and%20reactive/2015/06/17/defining-microservice-architecture.html">Defining The Microservice Architecture</a></li>
    
  
  
  
    <li><a href="/getting/started/with/microservices/2015/06/10/service-discovery-overview.html">Service Discovery Overview</a></li>
    
  
  
  
    <li><a href="/microservices%20and%20reactive/2015/06/04/microservices-security-oauth-vs-session.html">Microservices Security&#58; OAuth vs Session</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">March 2015</h4>
  <ul>
    
    
    <li><a href="/microservices%20and%20reactive/2015/03/02/the-real-silver-bullet.html">Best Practice Developer techniques&#58; The Hunt for The Silver Bullet</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">February 2015</h4>
  <ul>
    
    
    <li><a href="/microservices%20and%20reactive/2015/02/16/retiring-microservices-using-strangulation.html">Retiring Microservices Using Strangulation</a></li>
    
  
  
  
    <li><a href="/microservices%20and%20reactive/2015/02/10/avoid-microservice-platform-lock-in-service-discovery.html">Avoid Microservice Platform Lock In using Service Discovery</a></li>
    
  
  
  
  </ul>
  <h4 id="y2015">January 2015</h4>
  <ul>
    
    
    <li><a href="/blog/2015/01/23/the-role-of-data-in-microservices.html">The Role of Data in Microservices</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/12/sharing-code-between-microservices.html">Sharing Code Between Microservices?</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/09/development-by-slogan-dry-part3.html">Development by Slogan with DRY&#58; Part 3, DRY vs WET</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/08/development-by-slogan-dry-part2.html">Development by Slogan with DRY&#58; Part 2, The Tower of Coupling</a></li>
    
  
  
  
    <li><a href="/blog/2015/01/01/development-by-slogan-dry-part1.html">Development by Slogan with DRY&#58; Part 1, Really DRY</a></li>
    
  
  
  
  </ul>
  <h4 id="y2013">April 2013</h4>
  <ul>
    
    
    <li><a href="/blog/2013/04/21/all-hail-command.html">Simplicity in Grails Design – All Hail the Command Object</a></li>
    
  
  
  
    <li><a href="/blog/2013/04/18/future-of-grails.html">The Future of Grails</a></li>
    
  
  
  
  </ul>
  <h4 id="y2013">March 2013</h4>
  <ul>
    
    
    <li><a href="/blog/2013/03/28/stateless-services-are-evil.html">Simplicity in Web Architecture - Beware the Stateless Service</a></li>
    </ul>
  
</div>
<div class='links'>
  <a href="/blog/tags"><em>Browse all tags</em></a>
</div>

<div class='links'>

</div>

    </div>
  </div>
</div>

          </div>
        </div>
        <div class='four spacing'></div>
      </div>
    </div>
  </div>
</div>

    </div>

    <div class='full no-padding' style='background: #111'>
  <div class='two spacing'></div>
  <div class='row'>
    <div class='large-12 columns' style="color:white;">
      <p>©2017 David Dawson Ltd. All rights reserved.</p>
    </div>
  </div>
  <div class='spacing'></div>
</div>


<script src="/javascripts/jquery.countTo.js" type="text/javascript"></script>
<script src="/javascripts/jquery.appear.js" type="text/javascript"></script>
<script src="/javascripts/jquery.validate.js" type="text/javascript"></script>
<script src="/javascripts/jquery.sequence-min.js" type="text/javascript"></script>
<script src="/javascripts/jquery.easing.1.3.js" type="text/javascript"></script>
<script src="/javascripts/app.js" type="text/javascript"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-91527202-1', 'auto');
  ga('require', 'linkid');
  ga('send', 'pageview');

</script>


  </body>

</html>
